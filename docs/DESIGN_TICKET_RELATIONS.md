# 関連チケットとグラフ可視化（設計メモ）

## 結論（運用方針）
- **verified / closed は終端**。再変更しない。
- 再発や誤クローズ時は **新しいチケットを起票**し、元チケットと **関連付け**る。
- 関連付けはまず **軽量なリンク（エッジ）** で開始し、将来グラフ可視化へ拡張する。

## 関連チケット（最小構成）
### 目的
- 再発や誤クローズ時のトレーサビリティを確保する。
- チケット間の依存/重複/再発を整理する。

### データモデル（最小）
- `ticket_links` テーブル（エッジ）で **関係タイプ** を保持する。
- 例: `reopened_from` / `related` / `duplicate_of` / `blocks` / `blocked_by`

### UI（初期）
- チケット詳細に「関連チケット」リストを表示
- 関係タイプ・公開ID・件名・状態・優先度を表示
- 後から「グラフ表示」に拡張可能な構造を維持

## 再トリアージについて
- **triage は初期分類**のため、完了後に戻すのは通常は不要。
- 再発時は「**新規チケット起票 + reopened_from**」で扱う方が履歴が明確。
- ただし運用上必要なら、`resolved -> waiting/in_progress` の再オープンで十分。
- triage への戻しは **運用上の混乱を招きやすい**ため基本は非推奨。

## グラフ可視化（将来拡張）
### ねらい
- 障害の波及・依存関係・再発パターンを可視化。
- Incident タイムラインと併せて分析可能にする。

### 段階的導入
1. **関連チケット一覧**（最小）
2. **簡易グラフ**（重要チケットのみ）
3. **Incident中心グラフ**（relation_types を重み付きエッジ化）

### 実装上の注意
- まずは **エッジ数を制限**して表示を簡潔にする。
- “全部を繋げる” よりも **用途に合わせたフィルタ**が重要。
- 将来的に「依存度」や「関係強度」を **重み** として扱うと分析に役立つ。
